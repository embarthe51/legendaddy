<%= simple_form_for Availability.new do |f| %>
  <%= f.input :start_at, as: :string, default: target_day, input_html: { data: { submit_hours_target: "input"} }%>
  <%= f.input :end_at, as: :string, default: target_day, input_html: { data: { submit_hours_target: "input" } } %>
  <%= f.hidden_field :date, value: day %>
  <%= f.hidden_field :tab_id, value: tab_day %>
  <%= f.submit value: "Ajouter ma dispo", class:"yellow-button"%>
<% end %>

<div class="container">
  <div class="calendar mt-3">
    <div class="timeline">
      <% i = 9 %>
      <% 12.times do %>
        <p class="border-end border-light border-3 pe-3"><%= (Date.today+i.hours).strftime("%H:%M") %></p>
        <% i += 1 %>
      <% end %>
    </div>
    <div class="days">
      <% if bookings.exists? %>
        <% bookings.each do |booking|  %>
          <% if booking.start_at.strftime('%a %d %b %Y') == day.strftime('%a %d %b %Y') %>
            <% beg = (booking.start_at.hour - 9) * 60 %>
            <% duration = ((booking.end_at.hour - 9) - (booking.start_at.hour - 9)) * 60 %>
            <div class="booking start-at-<%=beg%> duration-<%=duration%> text-center d-flex flex-column justify-content-center" >
              <p class="title"><%=booking.activity.title%></p>
              <p class="schedule">de <%=booking.start_at.hour%>h à <%=booking.end_at.hour%>h</p>
              <p class="activity-result"> <%= link_to "Voir les détails", booking_path(booking), class:"yellow-button-a" %></p>
            </div>
          <% end %>
        <% end %>
      <% end %>
      <% if grouped_availabilities[day.strftime('%a %d %b %Y')] %>
        <% grouped_availabilities[day.strftime('%a %d %b %Y')].each do |availability|%>
          <% beg = (availability.start_at.hour - 9) * 60 %>
          <% duration = ((availability.end_at.hour - 9) - (availability.start_at.hour - 9)) * 60 %>
          <div class="event start-at-<%=beg%> duration-<%=duration%> text-center d-flex flex-column justify-content-center" >
            <p class="title">Créneau horaire disponible</p>
            <p class="schedule">de <%=availability.start_at.hour%>h à <%=availability.end_at.hour%>h</p>
            <p class="activity-result">
            <% if Activity.on_availability(availability).count == 1 %>
                <%= link_to "#{Activity.on_availability(availability).count} activité dispo", availability_activities_path(availability), class:"yellow-button-a" %>
              <% elsif Activity.on_availability(availability).count > 1  %>
                <%= link_to "#{Activity.on_availability(availability).count} activités dispo", availability_activities_path(availability), class:"yellow-button-a" %>
              <% elsif Activity.on_availability(availability).count == 0  %>
                <%= "Pas d'activité dispo sur ce creneau" %>
            <% end %>
            </p>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
